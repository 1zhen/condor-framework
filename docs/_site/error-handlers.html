<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>Condor GRPC Framework by devsu</title>

  <link rel="stylesheet" href="/assets/css/style.css?v=83df022557678abb210c79943f5552f63f1f98c8">
  <meta name="viewport" content="width=device-width">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>
<div class="wrapper">
  <header>
    <h1>Condor GRPC Framework</h1>
    <p>A GRPC Framework for Node</p>

    
    <p class="view"><a href="http://github.com/devsu/condor-framework">View the Project on GitHub <small></small></a></p>
    

    

    
  </header>
  <section>
    <h3>Table of contents</h3>
    
      
        <a href="middleware">middleware</a>
      
    
      
        <a href="authentication">authentication</a>
      
    
      
        <a href="errorHandlers">error handlers</a>
      
    
  </section>
  <section>

    
<h3 id="error-handlers">Error handlers</h3>

<p>You can add one or many error handlers to your app. The error handlers are run if an error is thrown, or a promise is rejected from a middleware or from the actual service implementation.</p>

<h4 id="how-to-use">How to use</h4>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the error handler returns a <strong>promise that resolves with nothing</strong>, Condor will wait for the promise to be fulfilled before continuing to the next handler.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="nx">resolve</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the error handler returns a <strong>promise that resolve with any value</strong>, Condor will stop the error handler chain.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="nx">resolve</span><span class="p">({</span> <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'something'</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the error handler returns a <strong>promise that rejects</strong>, Condor will stop the error handler chain.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="nx">reject</span><span class="p">({</span> <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'something'</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the error handler <strong>does not return anything</strong>, Condor will wait for the promise to be fulfilled before continuing to the next handler.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>If the error handler returns <strong>a value</strong>, Condor will stop the error handler chain.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Condor</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">scope</span> <span class="o">=</span> <span class="s1">'myapp'</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'something'</span> <span class="p">};</span>
<span class="p">});</span>
</code></pre>
</div>

<h4 id="scope">Scope</h4>

<p>When a scope argument is not provided the handler will catch errors on any request.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">((</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Scope can be a package name.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="s1">'myapp'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Will catch errors of any services in the `myapp` package.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Or a service name.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="s1">'myapp.Greeter'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// will catch errors of any methods of the `Greeter` service of the `myapp` package.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Or a specific method name.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">(</span><span class="s1">'myapp.Greeter.sayHello'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// will catch errors of the myapp.Greeter.sayHello method.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Something went wrong'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'for the request'</span><span class="p">,</span> <span class="nx">call</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="modifying-the-error-response">Modifying the error response</h3>

<p>You can modify the error object from your error handlers:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">addErrorHandler</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">error</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">PERMISSION_DENIED</span><span class="p">;</span>
  <span class="nx">error</span><span class="p">.</span><span class="nx">details</span> <span class="o">=</span> <span class="s1">'You do not have enough permissions'</span><span class="p">;</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The modified error will be passed to the next error handler, and finally to the client.</p>

<h3 id="default-error-handler">Default error handler</h3>

<p>After running all error handlers, the server will respond to the client with the error (which can be modified by the handlers).</p>

<p>If the response is a stream, it will emit the <code class="highlighter-rouge">error</code>.</p>


  </section>
  <footer>
    
    <p>This project is maintained by <a href="http://github.com/devsu">devsu</a></p>
    
  </footer>
</div>
<script src="/assets/js/scale.fix.js"></script>



</body>
</html>
